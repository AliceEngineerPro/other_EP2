# 联邦学习简介

## 1. 背景

联邦学习（Federated Learning）是一种新兴的人工智能基础技术
在 2016 年由谷歌最先提出，原本用于解决安卓手机终端用户在本地更新模型的问题，其设计目标是在保障大数据交换时的信息安全、保护终端数据和个人数据隐私、保证合法合规的前提下，在多参与方或多计算结点之间开展高效率的机器学习
其中，联邦学习可使用的机器学习算法不局限于神经网络，还包括随机森林等重要算法
联邦学习有望成为下一代人工智能协同算法和协作网络的基础。

## 2. 联邦学习的系统架构

下面以包含两个数据拥有方（即企业 A 和 B）的场景为例，来介绍联邦学习的系统构架。该构架可扩展至包含多个数据拥有方的场景,假设企业 A 和 B 想联合训练一个机器学习模型，它们的业务系统分别拥有各自用户的相关数据。
此外，企业 B 还拥有模型需要预测的标签数据。                 
出于数据隐私保护和安全考虑，A 和 B 无法直接进行数据交换，可使用联邦学习系统建立模型。
联邦学习系统构架由三部分构成，如图所示：       

![](https://gitee.com/alicehomeindex/pic/raw/Master-Release/Markdown/lblearn/farmework_lb.jpg)

**第一部分：** 加密样本对齐。

由于两家企业的用户群体并非完全重合，系统利用基于加密的用户样本对齐技术，在 A 和 B 不公开各自数据的前提下确认双方的共有用户，并且不暴露不互相重叠的用户，以便联合这些用户的特征进行建模。

**第二部分：** 加密模型训练。

在确定共有用户群体后，就可以利用这些数据训练机器学习模型。为了保证训练过程中数据的保密性，需要借助第三方协作者 C 进行加密训练。

以线性回归模型为例，训练过程可分为以下 4 步（如上图所示）： 

第①步：协作者 C 把公钥分发给 A 和 B，用以对训练过程中需要交换的数据进行加密。

第②步：A 和 B 之间以加密形式交互用于计算梯度的中间结果。

第③步：A 和 B 分别基于加密的梯度值进行计算，同时 B 根据其标签数据计算损失，并把结果汇总给 C。C 通过汇总结果计算总梯度值并将其解密。

第④步：C 将解密后的梯度分别回传给 A 和 B，A 和 B 根据梯度更新各自模型的参数。

迭代上述步骤直至损失函数收敛，这样就完成了整个训练过程。

在样本对齐及模型训练过程中，A 和 B 各自的数据均保留在本地，且训练中的数据交互也不会导致数据隐私泄露。

因此，双方在联邦学习的帮助下得以实现合作训练模型。

**第三部分：** 效果激励。

联邦学习的一大特点就是它解决了为什么不同机构要加入联邦共同建模的问题，即建立模型以后模型的效果会在实际应用中表现出来，并记录在永久数据记录机制（如区块链）上。            
提供数据多的机构所获得的模型效果会更好，模型效果取决于数据提供方对自己和他人的贡献。这些模型的效果在联邦机制上会分发给各个机构反馈，并继续激励更多机构加入这一数据联邦。

以上三部分的实施，既考虑了在多个机构间共同建模的隐私保护和效果，又考虑了以一个共识机制奖励贡献数据多的机构。
所以，联邦学习是一个 **闭环** 的学习机制。

## 3. 联邦学习的优势

（1）数据隔离，数据不会泄露到外部，满足用户隐私保护和数据安全的需求；  
（2）能够保证模型质量无损，不会出现负迁移，保证联邦模型比割裂的独立模型效果好；  
（3）参与者地位对等，能够实现公平合作；  
（4）能够保证参与各方在保持独立性的情况下，进行信息与模型参数的加密交换，并同时获得成长。

## 4. 什么是联邦学习

联邦学习（Federated Learning, FL）是一种机器学习方法，客户端（例如移动设备或多个组织）在中央服务器（例如服务提供商）的协调下**共同训练模型**，同时保持训练数据的**去中心化及分散性**。

<img src="https://imgbed.momodel.cn/FL_intro.png" width=500 />

### 4.1  **联邦学习示例：银行贷款风险评估**

银行贷款的风险主要来自于借款人的风险。而借款人的风险与他的家庭关系、工作情况、储蓄情况等具有一定的关系
因此，借款人的状况分析是贷款风险管理的基础，也是贷款风险评估的主要内容
建立深度学习模型来判断客户逾期还款的概率，可以帮助金融贷款机构快速地进行贷款风险管理
由于每个银行内部的客户信息是需要保密的，所以通常我们不能把所有的数据放在一起进行学习，因此我们要学习使用联邦学习

## 5. 联邦学习与传统分布式的区别

联邦学习在 2016 年由谷歌最先提出，原本用于解决安卓手机终端用户在本地更新模型的问题，其设计目标是在保障大数据交换时的信息安全、保护终端数据和个人数据隐私、保证合法合规的前提下，在多参与方或多计算结点之间开展高效率的机器学习。

传统的分布式是把一个需要非常巨大的计算能力才能解决的问题分成许多小的部分，然后把这些部分分配给多个计算机进行处理，最后把这些计算结果综合起来得到最终的结果。

联邦学习与传统的分布式学习非常相似，但他们也有以下区别:

1）联邦学习中 server 对数据和设备有绝对的控制权
2）参与联邦学习的设备（如手机）不稳定、且各个设备之间性能相差较大
3）联邦学习的通信代价非常大，远大于计算代价
4）联邦学习的数据并不是独立同分布的
5）联邦学习的节点负载不平衡

我们在之后的学习中会探索联邦学习的三个亟待解决的问题：
1）**通信问题。** 通信时耗时且不稳定，可以增加节点的计算量从而减少通信次数
2）**隐私保护问题。** 
3）**提高联邦学习的鲁棒性。**
